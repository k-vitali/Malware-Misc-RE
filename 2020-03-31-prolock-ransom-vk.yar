/*

|\¯¯¯-¯) |\¯¯¯,¯)°   /¯¯,¯¯\  |¯¯¯|__'  /¯¯,¯¯\   /¯¯¯/\__) °|¯¯¯|/¯¯/  '
 \|__|¯| ' \|__|\__)' |\____ /|' |_____'| |\____ /|' |\     \/¯¯¯) |___|\___\ '
  |__|¯     |__|\|__|  \|___ |/ °|_____'|  \|___ |/ ° \|¯¯¯¯¯¯|  |___|\|___| 
                                                                 ¯¯¯¯¯¯'          '       
       
*/

rule crime_win32_ransom_prolock_1 {
meta:
	description = "Detects ProLock ransomware"
	author = "@VK_Intel"
	reference = "twitter"
	tlp = "white"
	date = "2020-03-31"


strings:
	$str1 = "ProLock"
	$str2 = "\\[HOW TO RECOVER FILES].TXT" wide

	$how_to = { c1 ?? ?? ?? ?? ?? ?? 31 d2 8d ?? ?? ?? ?? ?? 8b ?? ?? 8b ?? ?? ?? 89 ?? ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? ?? 83 c2 02 3b ?? ?? ?? ?? ?? 72 ?? b8 63 51 e1 b7 31 d2 8d ?? ?? ?? ?? ?? b9 63 51 e1 b7 81 c1 b9 79 37 9e 89 ?? ?? 89 ?? ?? ?? 83 c2 02 8d ?? ?? ?? ?? ?? 83 fa 2c 8d ?? ?? ?? ?? ?? 75 ?? 31 c0 31 db 31 d2 31 ff 55 31 ed 01 d8 03 ?? ?? ?? ?? ?? ?? c1 c0 03 8d ?? ?? 89 ?? ?? ?? ?? ?? ?? 01 c3 03 ?? ?? ?? ?? ?? ?? d3 c3 89 ?? ?? ?? ?? ?? ?? 01 d8 03 ?? ?? ?? ?? ?? ?? c1 c0 03 8d ?? ?? 89 ?? ?? ?? ?? ?? ?? 01 c3 03 ?? ?? ?? ?? ?? ?? d3 c3 89 ?? ?? ?? ?? ?? ?? 83 c2 02 83 c7 02 83 c5 02 83 ff 2c 19 c9 21 cf 3b ?? ?? ?? ?? ?? 19 c9 21 cd 81 fa 84 00 00 00 72 ?? 5d c3}
	$rol4_ = {68 00 01 00 00 8d ?? ?? 52 8d ?? ?? 52 ff ?? ?? ?? ?? ?? 8d ?? ?? 52 8d ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 2b ?? ?? ?? ?? ?? 03 ?? ?? ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 83 f8 ff 75 ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6a 00 68 80 00 00 00 6a 02 6a 00 6a 00 68 00 00 00 40 8d ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 2b ?? ?? ?? ?? ?? 03 ?? ?? ?? ?? ?? 6a 00 8d ?? ?? ?? ?? ?? 52 68 1d 04 00 00 57 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ??}


condition:
( uint16(0) == 0x5a4d and
( 3 of them )
) or ( all of them )
}
