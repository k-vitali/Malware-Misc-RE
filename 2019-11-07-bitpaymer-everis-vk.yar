import "pe"

rule crime_bitpaymer_ransomware_1 {
   meta:
      description = "Detects BitPaymer payload"
      author = "@VK_Intel"
      reference = "https://twitter.com/VK_Intel/status/1192690031019937792"
      date = "2019-11-08"
      hash1 = "78e180e5765aa7f4b89d6bcd9bcef1dd1e0d0261ad0f9c3ec6ab0635bf494eb3"
   strings:
      $s1 = "@C:\\aaa_TouchMeNot_.txt" fullword wide
      $hash_function = { 56 57 8b fa 8b f1 8b cf e8 ?? ?? ?? ?? 85 c0 75 ?? 81 fe 2a 39 81 02 75 ?? 33 c0 5f 5e c3 8b ce e8 ?? ?? ?? ?? 85 c0 75 ?? 8b ce e8 ?? ?? ?? ?? 84 c0 74 ?? 8b ce e8 ?? ?? ?? ?? 85 c0 74 ?? 8b d7 8b c8 5f 5e e9 ?? ?? ?? ??}
   condition:
      ( uint16(0) == 0x5a4d and
         filesize < 200KB and
         pe.imphash() == "f4ae67c9e8bc20f92225adc1c52e833b" and
         ( all of them )
      ) or ( all of them )
}

