/*
                     __  .__                                                                          
  ____  ____   _____/  |_|__| ____________    ____   __________   _______  _  _______ _______   ____  
_/ ___\/  _ \ /    \   __\  | \_  __ \__  \  /    \ /  ___/  _ \ /     \ \/ \/ /\__  \\_  __ \_/ __ \ 
\  \__(  <_> )   |  \  | |  |  |  | \// __ \|   |  \\___ (  <_> )  Y Y  \     /  / __ \|  | \/\  ___/ 
 \___  >____/|___|  /__| |__|  |__|  (____  /___|  /____  >____/|__|_|  /\/\_/  (____  /__|    \___  >
     \/           \/                      \/     \/     \/            \/             \/            \/ 
     
*/
     
rule crime_win32_conti_ransom_1 {
meta:
	description = "Detects Conti ransomware v1"
	author = "@VK_Intel"
	reference = "twitter"
	tlp = "white"
	date = "2020-08-31"
	md5 = "03298E0FCEBB78D15C75D919DFB99553"

strings:
	$str0 = "RSA1"
	$str1 = "Rstrtmgr.dll"
	$str2 = ".rsrc$01"

	$start_prologue = {55 8b ec 83 e4 f8 81 ec 8c 04 00 00 a1 ?? ?? ?? ?? 33 c4 89 ?? ?? ?? ?? ?? ?? 53 56 57 e8 ?? ?? ?? ?? 85 c0 75 ?? 6a 01 ff ?? ?? ?? ?? ?? c6 ?? ?? ?? ?? bb 7f 00 00 00 c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? c6 ?? ?? ?? ?? 8a ?? ?? ?? 80 ?? ?? ?? ?? 75 ?? 33 f6 66 90}
	$decode_func = {80 ?? ?? 75 ?? 53 56 57 bf 0e 00 00 00 8d ?? ?? 8d ?? ?? 8a ?? 8d ?? ?? 0f b6 c0 83 e8 1a 8d ?? ?? c1 e0 02 99 f7 fb 8d ?? ?? 99 f7 fb 88 ?? ?? 83 ef 01 75 ?? 5f 5e 5b 8d ?? ?? c3}


condition:
( uint16(0) == 0x5a4d and
( 3 of them )
) or ( all of them )
}
